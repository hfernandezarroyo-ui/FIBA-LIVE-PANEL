<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FIBA Live Panel — Ultra Seguro</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">FIBA Live Panel — Ultra Seguro</h1>
    <input id="apiKey" type="password" placeholder="Pega tu X-RapidAPI-Key" class="px-3 py-2 border rounded w-full mb-3" />
    <button id="saveKey" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar clave</button>
    <div id="status" class="mt-3 text-sm text-gray-600">—</div>
    <div id="list" class="mt-4 space-y-3"></div>
  </div>
<script>
const HOST = "api-basketball.p.rapidapi.com";
const keyInput = document.getElementById('apiKey');
const saveBtn = document.getElementById('saveKey');
const statusEl = document.getElementById('status');
const listEl = document.getElementById('list');

keyInput.value = localStorage.getItem('RAPID_KEY') || "";
saveBtn.onclick = () => {
  localStorage.setItem('RAPID_KEY', keyInput.value.trim());
  saveBtn.textContent = "Guardada ✓";
  setTimeout(() => saveBtn.textContent = "Guardar clave", 1500);
  fetchLive();
};

function signal(game){
  const q = game.periods?.current;
  const timer = game.status?.timer || "";
  const th = game.scores?.home?.total ?? 0;
  const ta = game.scores?.away?.total ?? 0;
  const diff = Math.abs(th - ta);
  const pts = th + ta;
  const fast = pts >= 150;
  if (q !== 4) return {tag:"ESPERA", reason:"Solo Q4"};
  const [mm,ss] = timer.split(":").map(x=>parseInt(x||"0"));
  if (mm > 8) return {tag:"ESPERA", reason:"Esperar últimos 8:00"};
  const need = fast ? 12 : 10;
  if (diff >= need) return {tag:"ENTRA", reason:`Ventaja ${diff} (${fast?"rápido":"lento"})`};
  return {tag:"ESPERA", reason:`Ventaja ${diff} < ${need}`};
}

async function fetchLive(){
  const key = (localStorage.getItem('RAPID_KEY') || "").trim();
  if (!key) { statusEl.textContent = "Pega tu X-RapidAPI-Key"; return; }
  statusEl.textContent = "Actualizando…";
  try{
    const r = await fetch(`https://${HOST}/games?live=all`, {
      headers: {"X-RapidAPI-Key": key, "X-RapidAPI-Host": HOST}
    });
    const j = await r.json();
    let games = (j.response || []).filter(g => (g.league?.name||"").toLowerCase().includes("fiba"));
    listEl.innerHTML = games.map(g => {
      const s = signal(g);
      return `<div class="p-3 border rounded">
        <div class="font-bold">${g.league?.name}</div>
        <div>${g.teams?.home?.name} vs ${g.teams?.away?.name}</div>
        <div>${g.scores?.home?.total} - ${g.scores?.away?.total}</div>
        <div>Periodo: Q${g.periods?.current} — Reloj: ${g.status?.timer}</div>
        <div><strong>${s.tag}</strong>: ${s.reason}</div>
      </div>`;
    }).join("");
    statusEl.textContent = `Última actualización: ${new Date().toLocaleTimeString()}`;
  }catch(err){
    statusEl.textContent = "Error: " + err;
  }
}
fetchLive();
setInterval(fetchLive, 10000);
</script>
</body>
</html>
